
<div class="datagrid-box">
	<div class="datagrid-title-box">
		<span class="icon">
			<i class="fa fa-th"></i>
		</span>
		<h5>Répertoire de contacts</h5>
	</div>
	<div class="datagrid-content-box">
		<table class="tab-12">
			<thead>
				<tr>
					<th class="tab-3">Nom</th>
					<th class="tab-3">Prénom</th>
					<th class="tab-3">Poste</th>
					<th class="tab-2">Département</th>
					<th class="tab-1"></th>
				</tr>
			</thead>
			<tbody>
				{{#employees}}
				<tr>
					<td class="lastname" data-id="{{id}}">
						<a href="#" class="lean" name="user" rel="leanModal">{{lastName}}</a>
					</td>
					<td class="firstname">{{firstName}}</td>
					<td>{{title}}</td>
					<td>{{department}}</td>
					<td>
						<a href="#" data-user-id="{{id}}" class="update">
							<span class="icon">
								<i class="fa fa-pencil"></i>
							</span>
						</a>
						<a href="#" data-user-id="{{id}}" class="delete">
							<span class="icon">
								<i class="fa fa-trash-o"></i>
							</span>
						</a>
					</td>
				</tr>
				{{/employees}}
			</tbody>
		</table>
	</div>
</div>
<div class="modal fade">
	<div class="modal-dialog"></div>
</div>

<script type="text/javascript">
	app.init = function(){
        Handlebars.registerHelper('xif', function(a, b, options){
            if ( a === b )
            {
                return options.fn( this );
            }
        });
        
        var templates = {};
        
        /*$('.modal').on('show.bs.modal', function(e,d){
            console.log('md show');
        });*/
        
        $.each(['modal','form'], function(i, name){
            $.get('/tmpl/' + name + '.html', function( data ){
                templates[ name ] = Handlebars.compile( data );
            });
        });
        
		$('.lastname').on('click', function(){
			$.ajax({
				url		: './users/user/' + $(this).data('id'),
				type	: 'GET',
				success	: function( rs ){
                    $('.modal-dialog').empty().append( templates.modal( rs[0] ) );
                    $('.modal').modal();
				}
			});
		});
		
		$('.delete').on('click', function(e){
			e.preventDefault();
			var $self	= $(this),
				id		= $(this).data('user-id');
			
			bootbox.confirm("Voulez-vous supprimer cet employé?", function(result) {
				if ( result )
				{
					$.ajax({
						url		: './users/delete/' + id,
						type	: 'DELETE',
						success	: function( rs ){
							if ( rs.success )
							{
								$self.closest('tr').remove();
							}
						}
					});
				}
			});
		});
		
		$('.update').on('click', function(e){
			e.preventDefault();
			var $self	= $(this),
				id		= $(this).data('user-id');
            
            $.ajax({
				url		: './users/user/' + $(this).data('user-id'),
				type	: 'GET',
				success	: function( rs ){
                    $('.modal-dialog').empty().append( templates.form( rs[0] ) );
                    $('.modal').modal().find('#test').on('click.callback', function(){
                        console.log('test');
                    });
                    //http://davidrs.com/wp/code-dynamic-modal-with-twitter-bootstrap-and-jquery/
                }
            });
		});
	};
</script>